<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riveredge Co-op Financial Master</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; background-color: #f4f7f6; color: #333; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { background-color: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 95%; max-width: 1100px; margin-bottom: 20px; }
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 15px; }
        .summary-card { background: #2c3e50; color: white; padding: 20px; border-radius: 8px; text-align: center; }
        .summary-card h3 { margin: 0; font-size: 0.85rem; text-transform: uppercase; opacity: 0.8; letter-spacing: 1px; }
        .summary-card p { margin: 10px 0 0; font-size: 1.8rem; font-weight: bold; }
        
        .controls { display: flex; gap: 15px; justify-content: center; align-items: center; margin-bottom: 20px; width: 100%; max-width: 1100px; }
        .search-bar { padding: 10px 15px; border: 1px solid #ccc; border-radius: 5px; width: 250px; font-size: 0.9rem; }
        .btn { border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; transition: opacity 0.3s; color: white; }
        .btn-blue { background-color: #3498db; }
        .btn-green { background-color: #27ae60; }
        .btn:hover { opacity: 0.8; }
        
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th { background-color: #2c3e50; color: #ffffff; padding: 12px; text-align: right; font-size: 0.85rem; }
        th:first-child, td:first-child { text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #ddd; font-size: 0.9rem; text-align: right; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        tfoot td { font-weight: bold; background: #ecf0f1; border-top: 2px solid #2c3e50; }
    </style>
</head>
<body>

<div class="container">
    <h2>Modern Era Performance Summary (2006&ndash;2024)</h2>
    <div class="summary-grid">
        <div class="summary-card"><h3>Total Surplus</h3><p>$4,419,626</p></div>
        <div class="summary-card" style="background: #27ae60;"><h3>Avg. Surplus %</h3><p>13.55%</p></div>
        <div class="summary-card" style="background: #2980b9;"><h3>Avg. Surplus / Share</h3><p>$2.74</p></div>
    </div>
</div>

<div class="controls">
    <input type="text" id="searchInput" class="search-bar" placeholder="Search by year..." onkeyup="renderTable()">
    <button class="btn btn-blue" onclick="toggleView()" id="toggleBtn">Show Modern Era Only (2006-2024)</button>
    <button class="btn btn-green" onclick="exportPDF()">Download PDF</button>
</div>

<div class="container" id="reportContent">
    <h2 id="tableTitle">35-Year Financial History</h2>
    <p style="font-size: 0.85rem; color: #666;">*Excludes Special Assessments. 2024 adjusted for one-time fire charge.</p>
    <table id="financialTable">
        <thead>
            <tr>
                <th>Year</th>
                <th>Adj. Income</th>
                <th>Adj. Expenses</th>
                <th>Annual Surplus</th>
                <th>Surplus %</th>
                <th>Per Share</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
        <tfoot>
            <tr>
                <td>TOTAL (2006-2024)</td>
                <td>$32,612,298</td>
                <td>$28,192,672</td>
                <td>$4,419,626</td>
                <td>13.55% (Avg)</td>
                <td>$2.74 (Avg)</td>
            </tr>
        </tfoot>
    </table>
</div>

<script>
    const data = [
        [1990, 1175653, 1105904], [1991, 1150811, 1114963], [1992, 1132520, 1156390],
        [1993, 1148098, 1157968], [1994, 1176289, 1182060], [1995, 1199082, 1216649],
        [1996, 1205655, 1115973], [1997, 1207776, 1080739], [1998, 1219649, 1026243],
        [1999, 1201838, 1044633], [2000, 1235657, 1187103], [2001, 1223933, 1299673],
        [2002, 1215986, 1244211], [2003, 1226416, 1352556], [2004, 1309588, 1417321],
        [2005, 1454039, 1484831], [2006, 1720108, 1462139], [2007, 1722145, 1485259],
        [2008, 1736837, 1544655], [2009, 1786259, 1459726], [2010, 1756859, 1452558],
        [2011, 1767961, 1509242], [2012, 1760891, 1534516], [2013, 1678876, 1308064],
        [2014, 1659232, 1512456], [2015, 1664369, 1455700], [2016, 1652452, 1317507],
        [2017, 1670183, 1394928], [2018, 1694196, 1435982], [2019, 1708893, 1477320],
        [2020, 1684945, 1350723], [2021, 1678636, 1463423], [2022, 1677006, 1626411],
        [2023, 1745779, 1649127], [2024, 1846671, 1752936]
    ];

    let showFull = true;

    function renderTable() {
        const tbody = document.getElementById('tableBody');
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        tbody.innerHTML = '';
        let filtered = showFull ? data : data.filter(r => r[0] >= 2006);
        if (searchTerm) filtered = filtered.filter(r => r[0].toString().includes(searchTerm));
        
        filtered.forEach(row => {
            const [year, inc, exp] = row;
            const surplus = inc - exp;
            const pct = ((surplus / inc) * 100).toFixed(2);
            const pShare = (surplus / 85027).toFixed(2);
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${year}${year === 2024 ? '*' : ''}</td>
                <td>$${inc.toLocaleString()}</td>
                <td>$${exp.toLocaleString()}</td>
                <td style="font-weight:bold;">${surplus < 0 ? '(' + Math.abs(surplus).toLocaleString() + ')' : '$' + surplus.toLocaleString()}</td>
                <td>${pct < 0 ? '(' + Math.abs(pct) + '%)' : pct + '%'}</td>
                <td>${pShare < 0 ? '(' + Math.abs(pShare) + ')' : '$' + pShare}</td>
            `;
            tbody.appendChild(tr);
        });
    }

    function toggleView() {
        showFull = !showFull;
        document.getElementById('toggleBtn').innerText = showFull ? "Show Modern Era Only (2006-2024)" : "Show Full 35-Year History";
        document.getElementById('tableTitle').innerText = showFull ? "35-Year Financial History" : "Modern Era Financial History (2006-2024)";
        renderTable();
    }

    async function exportPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.text(document.getElementById('tableTitle').innerText, 14, 15);
        doc.autoTable({ html: '#financialTable', startY: 20 });
        doc.save('Riveredge_Financial_Report.pdf');
    }

    renderTable();
</script>
</body>
</html>